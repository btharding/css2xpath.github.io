<!DOCTYPE html>
<html>
    <head>
        <title>CSS to XPath Converter</title>
        <script src="https://raw.githubusercontent.com/css2xpath/css2xpath/master/index.js"></script>
    </head>

    <body>
        <input type="text" />
        <pre id="result"></pre>

        <script>
            var input = document.querySelector('input'),
                result = document.getElementById('result'),
                timeout;

            input.addEventListener('keyup', function() {
                clearTimeout(timeout);
                timeout = setTimeout(function() {
                    var xpath = css2xpath(input.value);

                    result.innerHTML = format(xpath);
                }, 200);
            });

            function format(str, depth) {
                depth = depth || 0;

                return str.replace(/[\[\(\)\]]([^\(\[]*)/g, function(m, m2) {
                    m2 = format(m2, depth);
                    if (m === '[' || m === '(') {
                        if (m2.length < 5) {
                            return m + m2;
                        }
                        return m + '\n' + repeat('\t', depth++);
                    } else {
                        return '\n' + repeat('\t', --depth) + m;
                    }
                })
            }

            function repeat(str, num) {
                var result = '';

                for (num |= 0; num > 0; num >>>= 1, str += str) {
                    if (num & 1) {
                        result += str;
                    }
                }

                return result;
            }
        </script>
    </body>
</html>
